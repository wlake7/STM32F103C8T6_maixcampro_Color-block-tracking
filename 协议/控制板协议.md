# 总线舵机控制板通信协议

串口通信，波特率9600

# 指令包数据类型，16进制

指令格式：

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>Length</td><td>Cad</td><td>Prm 1···Prm N</td></tr></table>

$\bullet$  帧头：连续收到两个0x55，表示有数据包到达。

$\bullet$  数据长度：参数个数N加上一个指令加上数据长度本身占用的一个字节长度，即数据长度：Length  $= \mathrm{N} + 2$

$\bullet$  指令：各种控制指令。

$\bullet$  参数：除指令外需要补充的控制信息。

# 一、用户主动给控制板发送数据部分

用户的发送数据引脚接到控制板的RX插针上，当然用户的控制系统还要跟控制板进行共地（GND），如果用户发送正确数据到控制板，那么控制板上的蓝色LED2灯会闪一下，表明已经接收到正确数据。如果发送的是错误数据，那么蓝色LED2灯不会有任何反应，保持常亮，蜂鸣器会“滴、滴”响两声，提示用户发送数据错误。

1、指令名CMDSERVO_MOVE，说明：控制任意个舵机的转动。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>控制舵机的个数*3+5</td><td>3</td><td>Prm 1···Prm N</td></tr></table>

参数1：要控制舵机的个数

参数2：时间低八位

参数3：时间高八位

参数4：舵机ID号

参数5：角度位置低八位

参数6：角度位置高八位

参数.....：格式与参数4,5,6相同，控制不同舵机的角度位置举例：

$①$  控制1号舵机在1000ms内转到800的位置：

<table><tr><td>0x55 0x55</td><td>0x08</td><td>0x03</td><td>0x01 0xE8 0x03 0x01 0x20 0x03</td></tr></table>

$(2)$  控制2和9号舵机在800ms内2号转到800的位置，9号转到800的位置：

<table><tr><td>0x55 0x55</td><td>0x08</td><td>0x03</td><td>0x02 0x20 0x03 0x02 0x20 0x03 0x09 0x20 0x03</td></tr></table>

2、指令名CMD_ACTION_GROUP_RUN，说明：控制动作组运行，前提是该动作组已经下载到控制板。可以控制动作组运行的次数，如果想让该动作组一直运行，则次数的参数值为0，代表无限次。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>5</td><td>6</td><td>Prm 1 Prm 2 Prm 3</td></tr></table>

参数1：要运行的动作组的编号

参数2：动作组要运行的次数低八位

参数3：动作组要运行的次数高八位

举例：

$①$  控制8号动作组运行1次：

<table><tr><td>0x55 0x55</td><td>0x05</td><td>0x06</td><td>0x08 0x01 0x00</td></tr></table>

$(2)$  控制2号动作组运行无数次：

<table><tr><td>0x55 0x55</td><td>0x05</td><td>0x06</td><td>0x02 0x00 0x00</td></tr></table>

3、指令名CMD_ACTION_GROUP_STOP，说明：停止正在运行的动作组；如果动作组没有运行，也发送了此命令则不影响。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>2</td><td>7</td><td>无</td></tr></table>

举例：

停止正在运行的动作组：

<table><tr><td>0x55 0x55</td><td>0x02</td><td>0x07</td></tr></table>

4、指令名：CMD_ACTION_GROUP_SPEED，说明：控制动作组的速度，以百分比的形式表示，比如要控制1号动作组的速度是原来的2倍，则百分比数值为200，代表  $200\%$  。（如果动作组编号为0xFF，则代表调整所有下载的动作组的速度。）

注意：

1）调整的速度参数关机不保存，即每次开机动作组运行速度都是默认速度，若需调整速度，则需重新发送指令。

2）舵机有自己的极限速度，即若动作组的速度调快超过舵机的极限速度，该操作是没有意义的。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>5</td><td>11</td><td>Prm 1 Prm 2 Prm 3</td></tr></table>

参数1：要调整的动作组的编号参数2：速度百分比低八位参数3：速度百分比高八位

举例：

$①$  控制8号动作组以  $50\%$  的速度运行：

<table><tr><td>0x55 0x55</td><td>0x05</td><td>0x0B</td><td>0x08 0x32 0x00</td></tr></table>

$(2)$  控制板已下载了多个动作组，将全部动作组的速度调整为原来的3倍，即  $300\%$

<table><tr><td>0x55 0x55</td><td>0x05</td><td>0x0B</td><td>0xFF 0x2C 0x01</td></tr></table>

5、指令名：CMD_GET_BATTERY_VOLTAGE，说明：获取控制板电池电压，单位毫伏（mV）。发送此指令后控制板会立刻返回数据，返回的数据是带有两个参数的数据包。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>2</td><td>15</td><td>无</td></tr></table>

控制板返回数据包：

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>4</td><td>15</td><td>Prm 1 Prm 2</td></tr></table>

参数1：代表电压的低8位

参数2：代表电压的高8位

举例：

获取控制板电池电压：

<table><tr><td>0x55 0x55</td><td>0x02</td><td>0x0F</td></tr></table>

比如返回的电压值为  $7500\mathrm{mV}$

<table><tr><td>0x55 0x55</td><td>0x04</td><td>0x0F</td><td>0x4C 0x1D</td></tr></table>

6、指令名：CMD_MULT_SERVO_UNLOAD，说明：控制多个舵机马达掉电卸力，发送该指令后，对应的舵机就可以用手随意转动了。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>控制舵机的个数+3</td><td>20</td><td>Prm 1···Prm N</td></tr></table>

参数1：要控制舵机的个数参数2：舵机a的ID号参数3：舵机b的ID号参数......：舵机  $\mathbf{x}$  的ID号

举例：

$①$  控制1，2，3号舵机掉电马达掉电卸力。

<table><tr><td>0x55 0x55</td><td>0x06</td><td>0x14</td><td>0x03 0x01 0x02 0x03</td></tr></table>

$(2)$  控制1，2，3，4，5，6号舵机掉电马达掉电卸力。

<table><tr><td>0x55 0x55</td><td>0x09</td><td>0x14</td><td>0x06 0x01 0x02 0x03 0x04 0x05 0x06</td></tr></table>

7、指令名CMD_MULT_SERVO_POS_READ，说明：读取多个舵机的角度位置值。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>控制舵机的个数+3</td><td>21</td><td>Prm 1···Prm N</td></tr></table>

参数1：要读取的舵机个数

参数2：舵机a的ID号

参数3：舵机b的ID号

参数.....：舵机  $\mathbf{x}$  的ID号

控制板返回数据包：

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>读取舵机的个数*3+3</td><td>21</td><td>Prm 1···Prm N</td></tr></table>

参数1：要读取舵机的个数

参数2：舵机ID号

参数3：角度位置低八位

参数4：角度位置高八位

参数.....：格式与参数2,3,4相同，读取不同ID的角度位置。举例：

读取1,2,3,4,5,6号舵机的角度位置值：

<table><tr><td>0x55 0x55</td><td>0x09</td><td>0x15</td><td>0x06 0x01 0x02 0x03 0x04 0x05 0x06</td></tr></table>

比如返回的角度位置值全是500：

<table><tr><td rowspan="2">0x55 0x55</td><td rowspan="2">0x15</td><td rowspan="2">0x15</td><td>0x06 0x01 0xF4 0x01 0x02 0xF4 0x01 0x03 0xF4 0x01</td></tr><tr><td>0x04 0xF4 0x01 0x05 0xF4 0x01 0x06 0xF4 0x01</td></tr></table>

# 二、控制板主动给用户发送数据部分

控制板在运行过程中，状态发生了改变（比如某个动作组运行结束）会主动通过串口给用户发送数据的，因为能操作控制板的方式不止一种，手柄可以操作，连接蓝牙模块可以操作，通过用户二次开发接口（串口）也可以操作。所以要让不同的控制方式知道控制板当前所处的状态，以便自己的管理和操作。以下是控制板返回给用户的各指令。

1、指令名CMD_ACTION_GROUP_RUN，说明：当用户发送控制动作组运行的数据包，动作组开始运行的那一刻，控制板返回数据包，数据格式是与用户所发送数据包的格式是一样的。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>5</td><td>6</td><td>Prm 1 Prm 2 Prm 3</td></tr></table>

参数1：运行动作组的编号

参数2：动作组要运行的次数低八位

参数3：动作组要运行的次数高八位

举例：

当8号动作组运行并且次数为1次时，控制板向用户返回的数据为：

<table><tr><td>0x55 0x55</td><td>0x05</td><td>0x06</td><td>0x08 0x01 0x00</td></tr></table>

2、指令名 CMD_ACTION_GROUP_STOP，说明：当某个正在运行的动作组被其他方式比如手柄（或者用户自己通过发送停止动作组命令），将该运行的动作组强行停止时，返回该指令。该数据包与用户主动发送停止指令的数据包是一样的。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>2</td><td>7</td><td>无</td></tr></table>

举例：

某个正在运行的动作被强行终止运行时返回数据：

<table><tr><td>0x55 0x55</td><td>0x02</td><td>0x07</td></tr></table>

3、指令名 CMD_ACTION_GROUP_COMPLETE，说明：当某个动作组自然运行结束后（没有被强行停止运行，而是本身自然运行结束），返回该指令。

<table><tr><td>帧头</td><td>数据长度</td><td>指令</td><td>参数</td></tr><tr><td>0x55 0x55</td><td>5</td><td>8</td><td>Prm 1 Prm 2 Prm 3</td></tr></table>

参数1：运行动作组的编号

参数2：动作组要运行的次数低八位

参数3：动作组要运行的次数高八位

举例：

当8号动作组运行次数为1次，自然运行结束后，控制板向用户返回的数据：

<table><tr><td>0x55 0x55</td><td>0x05</td><td>0x08</td><td>0x08 0x01 0x00</td></tr></table>