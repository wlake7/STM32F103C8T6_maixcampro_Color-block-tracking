# 激光追踪系统快速开始指南

## 🚀 5分钟快速上手

### 准备工作 (2分钟)
1. **硬件检查**:
   - ✅ MaixCamPro + STM32F103C8T6
   - ✅ 2个Huaner LX-224舵机 (ID=1,2)
   - ✅ 绿色激光器 + OLED显示屏
   - ✅ 5V/2A电源适配器

2. **软件准备**:
   - ✅ STM32程序已编译烧录
   - ✅ MaixCam程序已上传
   - ✅ 红色目标物 (推荐红色小球)

### 连接设置 (2分钟)
```
快速连线图:
MaixCam Pin8(TX) ──→ STM32 PA10(RX)
MaixCam Pin10(RX) ──→ STM32 PA9(TX)
STM32 PA2(TX) ──→ 舵机总线
5V电源 ──→ STM32 + 舵机
```

### 启动测试 (1分钟)
1. **上电启动**:
   ```bash
   # 1. 给STM32上电 (OLED显示"Laser Tracker")
   # 2. 给MaixCam上电
   # 3. 运行MaixCam程序
   python /root/laser_tracker/main.py
   ```

2. **功能验证**:
   - 🔴 放置红色目标物在相机前
   - 🟢 观察绿色激光是否指向目标
   - 📱 OLED显示追踪状态信息

## 📋 详细操作步骤

### 第一步: 硬件连接
```
电源连接:
┌─────────────┐    5V/2A    ┌─────────────┐
│   电源适配器  │ ──────────→ │  STM32板    │
└─────────────┘             └─────────────┘
                                   │ 5V
                                   ↓
                            ┌─────────────┐
                            │   舵机电源   │
                            └─────────────┘

通信连接:
┌─────────────┐             ┌─────────────┐
│  MaixCam    │             │   STM32     │
│  Pin8(TX)   │ ──────────→ │  PA10(RX)   │
│  Pin10(RX)  │ ←────────── │  PA9(TX)    │
│  GND        │ ──────────→ │  GND        │
└─────────────┘             └─────────────┘
                                   │
                                   ↓ PA2(TX)
                            ┌─────────────┐
                            │  舵机总线    │
                            └─────────────┘
```

### 第二步: 软件配置
1. **STM32端**:
   ```c
   // 确认配置参数
   #define USART1_BAUDRATE     115200  // MaixCam通信
   #define USART2_BAUDRATE     115200  // 舵机通信
   #define SERVO_ID_VERTICAL   1       // 垂直舵机ID
   #define SERVO_ID_HORIZONTAL 2       // 水平舵机ID
   ```

2. **MaixCam端**:
   ```python
   # config.py 关键参数
   SERIAL_PORT = "/dev/ttyS1"
   BAUDRATE = 115200
   
   # 红色检测阈值 (LAB色彩空间)
   RED_TARGET_THRESHOLD = (30, 100, 15, 127, 15, 127)
   
   # PID参数
   PID_KP_H = 2.0    # 水平比例增益
   PID_KP_V = 2.5    # 垂直比例增益
   ```

### 第三步: 系统启动
1. **启动顺序**:
   ```bash
   # 步骤1: STM32上电
   # 观察OLED显示: "Laser Tracker v1.0"
   # LED指示灯亮起
   
   # 步骤2: MaixCam上电
   # 等待系统启动完成
   
   # 步骤3: 启动追踪程序
   cd /root/laser_tracker
   python main.py
   ```

2. **启动检查**:
   ```
   ✅ STM32 OLED显示正常
   ✅ 舵机移动到中心位置
   ✅ MaixCam程序运行无错误
   ✅ 串口通信建立成功
   ```

### 第四步: 功能测试
1. **基础测试**:
   ```python
   # 测试项目清单
   □ 舵机响应测试 (手动模式)
   □ 目标检测测试 (红色物体)
   □ 激光指向测试 (静态目标)
   □ 追踪功能测试 (移动目标)
   ```

2. **测试步骤**:
   ```bash
   # 1. 标定模式测试
   # 按键切换到CALIB模式
   # 舵机应移动到中心位置(120度)
   
   # 2. 手动模式测试
   # 按键切换到MANUAL模式
   # 可通过串口发送命令控制舵机
   
   # 3. 追踪模式测试
   # 按键切换到TRACK模式
   # 放置红色目标，观察追踪效果
   ```

## 🔧 常用操作

### 模式切换
```
按键操作:
短按 → 切换模式 (CALIB → TRACK → MANUAL → CALIB)
长按 → 系统复位

模式说明:
CALIB  : 标定模式 (舵机中心位置)
TRACK  : 追踪模式 (自动追踪红色目标)
MANUAL : 手动模式 (手动控制舵机)
```

### 状态监控
```
OLED显示信息:
┌─────────────────┐
│ State: TRACK    │ ← 当前工作模式
│ T:320,240       │ ← 目标位置坐标
│ L:315,245       │ ← 激光位置坐标
│ O:2.5,-1.2      │ ← PID输出值
└─────────────────┘

LED指示:
常亮   → 系统正常
慢闪   → 追踪模式
快闪   → 错误状态
```

### 参数调节
```python
# 快速参数调节 (config.py)

# 1. 检测不到红色目标
RED_TARGET_THRESHOLD = (20, 100, 10, 127, 10, 127)  # 放宽阈值

# 2. 追踪不稳定
PID_KP_H = 1.5  # 降低比例增益
PID_KD_H = 0.8  # 增加微分增益

# 3. 响应太慢
PID_KP_H = 3.0  # 增加比例增益
PID_KI_H = 0.2  # 增加积分增益

# 4. 追踪精度不够
MIN_BLOB_AREA = 30      # 降低最小检测面积
CONTROL_FREQUENCY = 60  # 提高控制频率
```

## ⚠️ 常见问题

### 问题1: 系统无响应
```
症状: OLED无显示，LED不亮
解决: 
1. 检查5V电源是否正常
2. 检查STM32程序是否烧录成功
3. 检查硬件连接是否正确
```

### 问题2: 检测不到目标
```
症状: 有红色物体但无法检测
解决:
1. 调整光照条件 (避免过亮或过暗)
2. 使用鲜艳的红色目标 (推荐红色小球)
3. 调整颜色检测阈值
4. 检查相机焦距是否合适
```

### 问题3: 追踪不稳定
```
症状: 激光抖动或无法稳定指向
解决:
1. 降低PID比例增益 (Kp)
2. 增加微分增益 (Kd)
3. 检查机械结构是否稳固
4. 减少环境干扰
```

### 问题4: 通信异常
```
症状: MaixCam与STM32无法通信
解决:
1. 检查串口连线 (TX-RX交叉连接)
2. 确认波特率设置 (115200)
3. 检查是否有其他程序占用串口
4. 重启通信程序
```

## 📊 性能指标

### 标准性能
```
追踪精度: ±2像素
响应时间: <100ms
控制频率: 50Hz
通信延迟: <10ms
角度分辨率: 0.24度
```

### 环境要求
```
工作温度: 0°C ~ 40°C
湿度范围: 20% ~ 80%
光照条件: 100 ~ 1000 lux
目标距离: 0.5m ~ 5m
目标大小: 2cm ~ 10cm
```

## 🎯 优化建议

### 提高精度
1. **相机标定**: 使用四角标定提高坐标映射精度
2. **PID调优**: 根据实际情况精细调节PID参数
3. **机械优化**: 使用高精度舵机和稳固支架

### 提高稳定性
1. **滤波处理**: 增加卡尔曼滤波或低通滤波
2. **预测算法**: 实现轨迹预测功能
3. **异常处理**: 完善错误检测和恢复机制

### 提高响应速度
1. **算法优化**: 使用ROI减少图像处理量
2. **硬件升级**: 使用更快的处理器
3. **协议优化**: 减少通信数据量

## 📞 技术支持

### 获取帮助
- 📖 **详细文档**: docs/User_Manual.md
- 🔧 **测试指南**: docs/STM32_System_Test.md
- 🔗 **集成指南**: docs/System_Integration_Guide.md

### 问题反馈
- 📧 **邮件支持**: 通过项目README联系方式
- 💬 **社区讨论**: GitHub Issues
- 📱 **在线文档**: 项目Wiki页面

---

**🎉 恭喜！您已成功完成激光追踪系统的快速配置！**

现在可以开始享受精确的激光追踪功能了！如需更高级的功能和详细配置，请参考完整的用户手册。
