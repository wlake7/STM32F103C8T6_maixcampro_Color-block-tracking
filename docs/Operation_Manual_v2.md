# 激光追踪系统操作手册 v2.0

## 版本更新说明

### v2.0 主要更新
- ✅ 新增控制板架构，提升舵机控制稳定性
- ✅ 优化通信协议，支持多舵机同步控制
- ✅ 增强错误处理和状态监控
- ✅ 改进系统集成和测试流程

### 架构变更
```
v1.0: MaixCam ↔ STM32 ↔ 直连舵机
v2.0: MaixCam ↔ STM32 ↔ 控制板 ↔ 串联舵机
```

## 快速操作指南

### 1. 系统启动 (3分钟)
```bash
# 步骤1: 硬件检查 (30秒)
□ 检查MaixCam-STM32连接 (Pin8→PA10, Pin10→PA9)
□ 检查STM32-控制板连接 (PA2→RX, PA3→TX)
□ 检查控制板-舵机连接 (串联总线)
□ 确认电源连接 (MaixCam 5V, 控制板 6-12V)

# 步骤2: STM32启动 (30秒)
□ STM32上电
□ 观察OLED显示 "Laser Tracker v2.0"
□ 等待显示 "CtrlBoard OK"
□ 确认舵机移动到中心位置

# 步骤3: MaixCam启动 (2分钟)
□ MaixCam上电并连接
□ 运行: python /root/laser_tracker/main.py
□ 观察系统标定过程
□ 确认显示 "系统标定完成"
```

### 2. 日常操作 (1分钟)
```bash
# 追踪操作
□ 准备红色目标物 (2-10cm)
□ 按键切换到追踪模式
□ 放置目标物在视野内
□ 观察激光跟随目标移动
□ 移动目标测试追踪效果
```

### 3. 系统关闭 (30秒)
```bash
# 安全关闭
□ 按Ctrl+C停止MaixCam程序
□ 等待程序完全退出
□ 断开STM32电源
□ 断开控制板电源
```

## 详细操作流程

### 硬件连接验证
1. **电源连接检查**:
   ```
   MaixCam:     5V/2A Type-C
   STM32:       5V/1A USB或外部
   控制板:      6-12V/3A (根据舵机功率)
   ```

2. **通信连接检查**:
   ```
   MaixCam Pin8(TX)  → STM32 PA10(RX)  [115200]
   MaixCam Pin10(RX) ← STM32 PA9(TX)   [115200]
   STM32 PA2(TX)     → 控制板 RX        [9600]
   STM32 PA3(RX)     ← 控制板 TX        [9600]
   ```

3. **舵机连接检查**:
   ```
   控制板舵机总线 → 舵机1(ID=1) → 舵机2(ID=2)
   ```

### 软件操作详解

#### MaixCam端操作
1. **模块测试**:
   ```bash
   cd /root/laser_tracker
   python test_import.py
   # 预期输出: "🎉 所有模块导入测试通过！"
   ```

2. **主程序启动**:
   ```bash
   python main.py
   # 观察启动日志:
   # - "激光追踪系统启动"
   # - "配置加载完成"
   # - "激光追踪器初始化完成"
   # - "系统标定完成"
   ```

3. **运行状态监控**:
   ```
   正常运行指标:
   - FPS: 25-30
   - 通信状态: 连接正常
   - 目标检测: 实时更新
   - 激光检测: 实时更新
   ```

#### STM32端操作
1. **启动状态检查**:
   ```
   OLED显示序列:
   1. "Laser Tracker v2.0"
   2. "Initializing..."
   3. "CtrlBoard OK"      ← 关键状态
   4. "State: CALIB"
   ```

2. **模式切换**:
   ```
   按键操作:
   - 短按: 切换模式 (CALIB → TRACK → MANUAL → CALIB)
   - 长按: 系统复位
   ```

3. **状态监控**:
   ```
   OLED信息解读:
   State: TRACK          # 当前模式
   T:320,240            # 目标位置
   L:315,245            # 激光位置
   Comm: OK             # 通信状态
   CtrlBoard: OK        # 控制板状态
   ```

### 控制板操作

#### 状态检查
1. **通信状态**:
   - STM32 OLED显示"CtrlBoard OK"
   - 控制板指示灯正常

2. **舵机响应测试**:
   ```
   标定模式下:
   - 舵机应移动到中心位置 (500/1000)
   - 位置误差 < ±10
   ```

3. **电池电压监控**:
   ```
   正常范围:
   - 6V系统: 5.5V - 7.5V
   - 12V系统: 10V - 14V
   ```

## 故障排除

### 常见问题快速解决

#### 1. 模块导入错误
```
错误: ModuleNotFoundError: No module named 'maixcam'
解决: 
□ 确认在MaixCam设备上运行
□ 检查文件路径是否正确
□ 运行 test_import.py 验证
```

#### 2. 控制板通信失败
```
现象: OLED显示"CtrlBoard ERR"
检查:
□ 波特率设置 (9600)
□ PA2/PA3接线
□ 控制板电源
□ 舵机ID配置
```

#### 3. 舵机不响应
```
现象: 舵机不移动
检查:
□ 控制板电源电压
□ 舵机总线连接
□ 舵机ID设置 (1,2)
□ 舵机供电是否充足
```

#### 4. 追踪精度差
```
现象: 激光偏离目标
调整:
□ 重新标定系统
□ 调整PID参数
□ 检查机械安装
□ 优化环境光照
```

### 高级故障诊断

#### 通信协议调试
1. **串口监控**:
   ```bash
   # 监控MaixCam-STM32通信
   minicom -D /dev/ttyS0 -b 115200
   
   # 监控STM32-控制板通信
   # 使用逻辑分析仪或示波器
   ```

2. **数据包分析**:
   ```
   MaixCam→STM32: [0xAA,0x55] + 长度 + 0x01 + 16字节位置数据 + 校验
   STM32→控制板: [0x55,0x55] + 长度 + 命令 + 数据 + 校验
   ```

#### 性能优化
1. **系统响应时间**:
   - 目标检测: < 33ms (30fps)
   - 通信延迟: < 10ms
   - 舵机响应: < 100ms

2. **追踪精度优化**:
   - 机械精度: ±1度
   - 控制精度: ±2度
   - 系统精度: ±3度

## 维护计划

### 日常维护 (每次使用)
- [ ] 检查硬件连接
- [ ] 清洁镜头和激光器
- [ ] 验证系统功能

### 周期维护 (每周)
- [ ] 校准系统精度
- [ ] 检查舵机磨损
- [ ] 更新软件日志

### 深度维护 (每月)
- [ ] 全面系统测试
- [ ] 参数优化调整
- [ ] 备份配置数据
- [ ] 检查硬件老化

## 技术支持

### 联系方式
- 技术文档: docs/目录
- 问题反馈: GitHub Issues
- 紧急支持: 查看README.md

### 常用命令参考
```bash
# MaixCam端
python test_import.py          # 模块测试
python main.py                 # 启动系统
tail -f /var/log/laser.log     # 查看日志

# 系统监控
top                            # 系统资源
df -h                          # 存储空间
free -m                        # 内存使用
```
