# STM32舵机测试功能使用指南

## 功能概述

为STM32激光追踪系统添加了舵机电机测试功能，用于检测控制板和舵机是否能正常工作。

## 功能特点

### 🎯 测试模式
- **循环运动**: 两个舵机按预设路径循环运动
- **8个测试位置**: 覆盖水平和垂直舵机的主要运动范围
- **实时显示**: OLED显示当前测试步骤
- **LED指示**: LED闪烁指示测试状态

### 🔧 测试位置序列
1. **水平左，垂直中** (200, 500)
2. **水平右，垂直中** (800, 500)  
3. **水平中，垂直上** (500, 200)
4. **水平中，垂直下** (500, 800)
5. **左上角** (200, 200)
6. **右上角** (800, 200)
7. **右下角** (800, 800)
8. **左下角** (200, 800)

## 使用方法

### 启动测试
1. **按键1**: 切换系统状态到手动模式 (MANUAL)
2. **按键2**: 启动舵机测试

### 停止测试
- **再次按键2**: 停止测试，舵机回到中心位置

### 状态指示
- **OLED第3行**: 显示测试状态 ("Servo Test Start" / "Servo Test Stop")
- **OLED第4行**: 显示当前测试步骤 ("Step: X/8")
- **LED**: 测试期间闪烁，停止时熄灭
- **串口输出**: 实时打印测试步骤信息

## 测试流程

```
开机 → 按键1切换到MANUAL模式 → 按键2启动测试 → 观察舵机运动 → 按键2停止测试
```

## 代码实现

### 新增函数
- `System_TestServoMotors()`: 舵机测试主函数
- 在 `System_ProcessKeys()` 中添加按键2处理
- 在 `System_MainLoop()` 的MANUAL模式中调用测试函数

### 测试参数
- **运动时间**: 每个位置1.5秒
- **切换间隔**: 每2秒切换到下一个位置
- **位置范围**: 200-800 (对应舵机控制板的位置值)

## 硬件要求

### 舵机配置
- **水平舵机ID**: 2 (`CONTROL_BOARD_SERVO_ID_HORIZONTAL`)
- **垂直舵机ID**: 1 (`CONTROL_BOARD_SERVO_ID_VERTICAL`)

### 控制板通信
- **波特率**: 9600
- **协议**: 0x55 0x55 + Length + Cmd + Parameters
- **命令**: CMD_SERVO_MOVE (3)

## 故障排除

### 舵机不动
1. 检查控制板电源
2. 检查串口连接 (STM32 ↔ 控制板)
3. 检查舵机ID配置
4. 检查舵机电源和连接

### 测试异常
1. 确认系统处于MANUAL模式
2. 检查OLED显示是否正常
3. 查看串口输出信息
4. 确认按键功能正常

### 通信问题
1. 检查控制板波特率设置 (9600)
2. 检查串口线连接
3. 测试控制板是否响应其他命令

## 调试信息

### 串口输出示例
```
开始舵机测试...
舵机测试: 水平左, 垂直中
舵机测试: 水平右, 垂直中
舵机测试: 水平中, 垂直上
...
舵机测试停止
```

### OLED显示示例
```
Line 1: Laser Tracker
Line 2: Manual Mode
Line 3: Servo Test Start
Line 4: Step: 3/8
```

## 扩展功能

### 自定义测试位置
可以修改 `System_TestServoMotors()` 函数中的位置参数:
```c
case 0:
    ControlBoard_MoveServo(CONTROL_BOARD_SERVO_ID_HORIZONTAL, 自定义位置, 1500);
    ControlBoard_MoveServo(CONTROL_BOARD_SERVO_ID_VERTICAL, 自定义位置, 1500);
    break;
```

### 调整测试速度
修改切换间隔:
```c
uint8_t current_step = (elapsed_time / 自定义间隔ms) % 8;
```

### 添加更多测试位置
增加case分支和修改循环数量:
```c
uint8_t current_step = (elapsed_time / 2000) % 新的步骤数;
```

## 注意事项

1. **安全第一**: 确保舵机运动范围内无障碍物
2. **电源充足**: 确保控制板和舵机电源充足
3. **测试环境**: 在安全环境下进行测试
4. **及时停止**: 发现异常立即按键2停止测试

## 版本信息

- **添加日期**: 2025-07-07
- **版本**: v2.1
- **兼容性**: STM32F103C8T6 + 舵机控制板
- **依赖**: ControlBoard.h, Key.h, OLED.h, LED.h
